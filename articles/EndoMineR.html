<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EndoMineR">
<title>EndoMineR • EndoMineR</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://docs.ropensci.org/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EndoMineR">
<meta property="og:description" content="EndoMineR">
<meta property="og:image" content="https://docs.ropensci.org/EndoMineR/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">EndoMineR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.0.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/EndoMineRPrinciples.html">EndoMineR Principles</a>
    <a class="dropdown-item" href="../articles/EndoMineR.html">Package overview</a>
    <a class="dropdown-item" href="../articles/Analysis.html">Analysis</a>
    <a class="dropdown-item" href="../articles/Barretts.html">Barrett's</a>
    <a class="dropdown-item" href="../articles/Polyps.html">Lower GI Polyps</a>
    <a class="dropdown-item" href="../articles/Data.html">Data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="http://gastrodatascience.com">
    <span class="fa fa fa fa-bullseye"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/GastroDS">
    <span class="fa fa fa fa-twitter"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/EndoMineR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="http://www.gastroenterologybook.com/">
    <span class="far fa far fa-book"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.nhs.uk/profiles/consultant/6029157">
    <span class="fas fa fas fa-stethoscope"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>EndoMineR</h1>
                        <h4 data-toc-skip class="author">Sebastian Zeki 2024-03-04</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/EndoMineR/blob/HEAD/vignettes/EndoMineR.Rmd" class="external-link"><code>vignettes/EndoMineR.Rmd</code></a></small>
      <div class="d-none name"><code>EndoMineR.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="aims-of-endominer">
<strong>Aims of EndoMineR</strong><a class="anchor" aria-label="anchor" href="#aims-of-endominer"></a>
</h2>
<p>The goal of EndoMineR is to extract as much information as possible from free or semi-structured endoscopy reports and their associated pathology specimens.</p>
<p>Gastroenterology now has many standards against which practice is measured although many reporting systems do not include the reporting capability to give anything more than basic analysis. Much of the data is locked in semi-structured text. However the nature of semi-structured text means that data can be extracted in a standardised way- it just requires more manipulation.</p>
<p>This package provides that manipulation so that complex endoscopic-pathological analyses, in line with recognised standards for these analyses, can be done.</p>
<p>##<strong>How is the package divided?</strong></p>
<p><br></p>
<p><img src="img/EndoMineRBasic.jpg" width="100%" style="display: block; margin: auto;"></p>
<p><br></p>
<p>The package is basically divided into parts. How all the parts are connected in shown in the figure above. The import of the raw data is left up to the user with the overall aim being that all the data is present in one dataframe.</p>
</div>
<div class="section level2">
<h2 id="extraction-and-cleaning">
<strong>1. Extraction and cleaning</strong><a class="anchor" aria-label="anchor" href="#extraction-and-cleaning"></a>
</h2>
<p>If using raw reports, then once you have imported the data into your R environment, you can go ahead and use the <strong>textPrep</strong> function. If you have pre-segregated data, then use the <strong>EndoPaste</strong> function (explained at the end of this section).</p>
<p>Once the data is ready you can use the <strong>textPrep</strong> function. This function is really a wrapper for a number of different functions that work on your data.</p>
<div class="section level4">
<h4 id="i--dusting-the-data">
<strong>i. Dusting the data</strong><a class="anchor" aria-label="anchor" href="#i--dusting-the-data"></a>
</h4>
<p>Firstly the data is cleaned up so that extra newlines, spaces, unnecessary punctuation etc is dealt with. Although you dont need to know the details of this, if you want to look under the hood you can see that this is part of the <strong>ColumnCleanUp</strong> function.</p>
</div>
<div class="section level4">
<h4 id="ii--spell-checking">
<strong>ii. Spell checking</strong><a class="anchor" aria-label="anchor" href="#ii--spell-checking"></a>
</h4>
<p>The textPrep also implements a spell checker (the <strong>spellCheck</strong> function). This really checks the spelling of gastroenterology terms that are present in the in-built lexicons. So, if for example the report contains the terms ‘Radiafrequency ablashion’ then this will be corrected using Radiofrequency ablation. This is one function that acts to standardise the text in the report so that downstream analyses can be robust.</p>
</div>
<div class="section level4">
<h4 id="iii-negative-phrase-removal">
<strong>iii.Negative phrase removal</strong><a class="anchor" aria-label="anchor" href="#iii-negative-phrase-removal"></a>
</h4>
<p>The text is then passed along to the <strong>NegativeRemove</strong> function. This will remove any phrases that contain negative sentences indicating a non-positive finding. For example it would remove ‘There is no evidence of dysplasia here’. This makes text extraction analyses, which often report the detection of a positive finding, much more accurate. If you wish to include negative phrases however, you can. This function is part of the parameters you can switch on and off for the <strong>textPrep</strong> function.</p>
</div>
<div class="section level4">
<h4 id="iv--term-mapping">
<strong>iv. Term mapping</strong><a class="anchor" aria-label="anchor" href="#iv--term-mapping"></a>
</h4>
<p>The next step is to perform term mapping. This means that variations of a term are all mapped to a single common term. For example ‘RFA’ and ‘HALO’ may be both mapped to ‘Radiofrequency ablation’. This is performed using the using the <strong>DictionaryInPlaceReplace</strong> function. This function looks through all of the lexicons included in this package to perform this. The lexicons are all manually created and consist of key-value pairs which therefore map a key which is the term variant) to a value (which is the standardised term that should be used).</p>
</div>
<div class="section level4">
<h4 id="sv--egregating-the-data">
<strong>Sv. egregating the data</strong><a class="anchor" aria-label="anchor" href="#sv--egregating-the-data"></a>
</h4>
<p>Finally the text is ready to separate into columns. The basic <strong>Extractor</strong> function will take your data with the list of terms you have supplied that act as the column boundaries and separate your data accordingly. It is up to the user to define the list of boundary keywords. This list is made up of the words that will be used to split the document. It is very common for individual departments in both gastroenterology and pathology to use semi-structured reporting so that the same headers are used between patient reports. The Extractor then does the splitting for each pair of words, dumps the text between the delimiter in a new column and names that column with the first keyword in the pair with some cleaning up and then returns the new dataframe.</p>
</div>
<div class="section level3">
<h3 id="what-if-my-data-is-already-in-columns">
<strong>What if my data is already in columns?</strong><a class="anchor" aria-label="anchor" href="#what-if-my-data-is-already-in-columns"></a>
</h3>
<p>Often the raw data is derived from a basic query to some endoscopy software. The output is likely to be a spreadsheet with some of the data (eg Endoscopist) already placed in separate columns. The report still needs to be tidied up in order to maximise what we can get from the data and especially the free text. In order to do the term mapping and negative removal etc it is therefore necessary for EndoMineR to merge all of the columns together, for each endoscopy, but it keeps the column headers as delimiters for use later. This is the case with the top left box in the first diagram.</p>
<p><strong>EndoPaste</strong> is provided as an optional function to get your data in the right shape to allow EndoMineR to process the data properly in this situation</p>
<p><strong>EndoPaste</strong> outputs two things: the data, as well as a list of delimiters (basically your column headings). The delimiters can then be used in the <strong>textPrep</strong> function. This would work as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#An example dataset</span></span>
<span><span class="va">testList</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>PatientName <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tom Hardy"</span>, <span class="st">"Elma Fudd"</span>, <span class="st">"Bingo Man"</span><span class="op">)</span>, </span>
<span>                         HospitalNumber <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H55435"</span>, <span class="st">"Y3425345"</span>, <span class="st">"Z343424"</span><span class="op">)</span>, Text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"All bad. Not good"</span>, </span>
<span><span class="st">"Serious issues"</span>, <span class="st">"from a land far away"</span><span class="op">)</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"data.frame"</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="op">-</span><span class="fl">3L</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myReadyDataset</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/EndoPaste.html">EndoPaste</a></span><span class="op">(</span><span class="va">testList</span><span class="op">)</span></span></code></pre></div>
<p>The dataframe can be obtained from myReadyDataset[1] and the delimiters from myReadyDataset[2]</p>
<p><br><br><br></p>
</div>
<div class="section level3">
<h3 id="can-i-have-an-example-please">
<strong>Can I have an example please?</strong><a class="anchor" aria-label="anchor" href="#can-i-have-an-example-please"></a>
</h3>
<p>As an example, here we use an sample dataset (which has not had separate columns selected already, so no need to use EndoPaste) as the input. This contains a synthetic dataset provided as part of the EndoMineR package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PathDataFrameFinalColon2</span><span class="op">&lt;-</span><span class="va">PathDataFrameFinalColon</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">PathDataFrameFinalColon2</span><span class="op">)</span><span class="op">&lt;-</span><span class="st">"PathReportWhole"</span></span>
<span><span class="fu">pander</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">PathDataFrameFinalColon2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table style="width:46%;" class="table">
<colgroup><col width="45%"></colgroup>
<thead><tr class="header">
<th align="center">PathReportWhole</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Hospital: Random NHS Foundation Trust Hospital Number: H2890235 Patient Name: al-Bilal, Widdad DOB: 1922-05-04 General Practitioner: Dr. Mondragon, Amber Date received: 2002-11-10 Clinical Details: Previous had serrated lesions ?,If looks more like UC, please provide Nancy severity index 3 specimen. Nature of specimen: Nature of specimen as stated on pot = ‘Ascending colon x2’|,Nature of specimen as stated on request form = ‘rectum’|,Nature of specimen as stated on pot = ‘4X LOWER, 4X UPPER OESOPHAGUS’|,Nature of specimen as stated on pot = ‘rectal polyp’| Macroscopic description: 1 specimens collected the largest measuring 3 x 5 x 2 mm and the smallest 3 x 5 x 5 mm Histology: The appearances are of a hyperplastic polyp.,8 pieces of tissue, the largest measuring 4 x 36 x 2 mm and the smallest 3 x 3.,Completeness of excision is uncertain as the base is not clearly visualised.,There is no ulceration.,Kikuchi level: sm2. Diagnosis: Colon, biopsy - Normal.,- Focal granulomatous inflammation, non-necrotising.,Duodenum, biopsy - within normal histological limits.,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia.,- Hyperplastic polyp .,Caecum polyp biopsies:- tubular adenoma, low grade dysplasia.,- Mild chronic inflammation within the oesophageal mucosa.,Sigmoid colon biopsies:- normal mucosa.,Sigmoid polyp excision:- tubular adenoma.</td>
</tr></tbody>
</table>
<table style="width:46%;" class="table">
<colgroup><col width="45%"></colgroup>
<thead><tr class="header">
<th align="center">PathReportWhole</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Hospital: Random NHS Foundation Trust Hospital Number: H2890235 Patient Name: al-Bilal, Widdad DOB: 1922-05-04 General Practitioner: Dr. Mondragon, Amber Date received: 2002-11-10 Clinical Details: Previous had serrated lesions ?,If looks more like UC, please provide Nancy severity index 3 specimen. Nature of specimen: Nature of specimen as stated on pot = ‘Ascending colon x2’|,Nature of specimen as stated on request form = ‘rectum’|,Nature of specimen as stated on pot = ‘4X LOWER, 4X UPPER OESOPHAGUS’|,Nature of specimen as stated on pot = ‘rectal polyp’| Macroscopic description: 1 specimens collected the largest measuring 3 x 5 x 2 mm and the smallest 3 x 5 x 5 mm Histology: The appearances are of a hyperplastic polyp.,8 pieces of tissue, the largest measuring 4 x 36 x 2 mm and the smallest 3 x 3.,Completeness of excision is uncertain as the base is not clearly visualised.,There is no ulceration.,Kikuchi level: sm2. Diagnosis: Colon, biopsy - Normal.,- Focal granulomatous inflammation, non-necrotising.,Duodenum, biopsy - within normal histological limits.,Sigmoid colon, polypectomy: - Tubular adenoma with moderate dysplasia.,- Hyperplastic polyp .,Caecum polyp biopsies:- tubular adenoma, low grade dysplasia.,- Mild chronic inflammation within the oesophageal mucosa.,Sigmoid colon biopsies:- normal mucosa.,Sigmoid polyp excision:- tubular adenoma.</td>
</tr></tbody>
</table>
<p><br></p>
<p>We can then define the list of delimiters that will split this text into separate columns, title the columns according to the delimiters and return a dataframe. each column simply contains the text between the delimiters that the user has defined. These columns are then ready for the more refined cleaning provided by subesquent functions.</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/EndoMineR">EndoMineR</a></span><span class="op">)</span></span>
<span><span class="va">mywords</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Hospital Number"</span>,<span class="st">"Patient Name:"</span>,<span class="st">"DOB:"</span>,<span class="st">"General Practitioner:"</span>,</span>
<span><span class="st">"Date received:"</span>,<span class="st">"Clinical Details:"</span>,<span class="st">"Macroscopic description:"</span>,</span>
<span><span class="st">"Histology:"</span>,<span class="st">"Diagnosis:"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">PathDataFrameFinalColon3</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Extractor.html">Extractor</a></span><span class="op">(</span><span class="va">PathDataFrameFinalColon2</span><span class="op">$</span><span class="va">PathReportWhole</span>,<span class="va">mywords</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="14%">
<col width="8%">
<col width="8%">
<col width="6%">
<col width="10%">
<col width="7%">
<col width="14%">
<col width="14%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="center">Start</th>
<th align="center">Hospital.Number</th>
<th align="center">Patient.Name</th>
<th align="center">DOB</th>
<th align="center">General.Practitioner</th>
<th align="center">Date.received</th>
<th align="center">Clinical.Details</th>
<th align="center">Macroscopic.description</th>
<th align="center">Histology</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">Hospital Random NHS Foundation Trust.</td>
<td align="center">H2890235.</td>
<td align="center">al-Bilal, Widdad.</td>
<td align="center">1922-05-04.</td>
<td align="center">Dr. Mondragon, Amber.</td>
<td align="center">2002-11-10.</td>
<td align="center">Previous had serrated lesions ?,If looks more like UC, please provide Nancy severity index. 3 specimen. Nature of specimen Nature of specimen as stated on pot = Ascending colon x2 |,Nature of specimen as stated on request form = rectum|,Nature of specimen as stated on pot = 4X LOWER, 4X UPPER OESOPHAGUS |,Nature of specimen as stated on pot = rectal polyp |.</td>
<td align="center">1 specimens collected the largest measuring 3 x 5 x 2 mm and the smallest 3 x 5 x 5 mm.</td>
<td align="center">The appearances are of a hyperplastic polyp.,8 pieces of tissue, the largest measuring 4 x 36 x 2 mm and the smallest 3 x 3.,Completeness of excision is uncertain as the base is not clearly visualised.,There is no ulceration.,Kikuchi level sm2..</td>
</tr></tbody>
</table>
<p>The <strong>Extractor</strong> function is embedded within <strong>textPrep</strong> so you may never have to use it directly, but you will always have to submit a list of delimiters so that <strong>textPrep</strong> can use the <strong>Extractor</strong> to do its segregation:</p>
<p><strong>textPrep</strong> takes the optional parameters NegEx which tells the <strong>textPrep</strong> to remove negative phrases like ‘There is no pathology here’ from the text.</p>
<p>There will always be a certain amount of data cleaning that only the end user can do before data can be extracted. There is some cleaning that is common to many endoscopy reports and so functions have been provided for this. An abvious function is the cleaning of the endoscopist’s name. This is done with the function <strong>EndoscEndoscopist</strong>. This removes titles and tidies up the names so that there aren’t duplicate names (eg “Dr. Sebastian Zeki” and “Sebastian Zeki”). This is applied to any endoscopy column where the Endoscopist name has been isolated into its own column.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/EndoscEndoscopist.html">EndoscEndoscopist</a></span><span class="op">(</span><span class="va">Myendo</span><span class="op">$</span><span class="va">Endoscopist</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Dr  Kekich, Annabelle"       "Dr  Sullivan, Shelby"       </span></span>
<span><span class="co">## [3] "Dr  Avitia Ramirez, Alondra" "Dr  Greimann, Phoua"        </span></span>
<span><span class="co">## [5] "Dr  Avitia Ramirez, Alondra"</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="data-linkage">
<strong>2. Data linkage</strong><a class="anchor" aria-label="anchor" href="#data-linkage"></a>
</h2>
<p>Endoscopy data may be linked with other types of data. The most common associated dataset is pathology data from biopsies etc taken at endoscopy. This pathology data should be processed in exactly the same way as the endoscopy data- namely with <strong>textPrep</strong> (with or without <strong>EndoPaste</strong>).</p>
<p>The resulting pathology dataset should then be merged with the endoscopy dataset using <strong>Endomerge2</strong> which will merge all rows with the same hospital number and do a fuzzy match (up to 7 days after the endoscopy) with pathology so the right endoscopy event is associated with the right pathology report.An example of merging the included datasets Mypath and Myendo is given here:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">v</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/Endomerge2.html">Endomerge2</a></span><span class="op">(</span><span class="va">Myendo</span>,<span class="st">'Dateofprocedure'</span>,<span class="st">'HospitalNumber'</span>,<span class="va">Mypath</span>,<span class="st">'Dateofprocedure'</span>,<span class="st">'HospitalNumber'</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="deriving-new-data-from-what-you-have">
<strong>3. Deriving new data from what you have</strong><a class="anchor" aria-label="anchor" href="#deriving-new-data-from-what-you-have"></a>
</h2>
<p>Once the text has been separated in to the columns of your choosing you are ready to see what we can extract. Functions are provided to allow quite complex extractions at both a general level and also for specific diseases.</p>
<div class="section level4">
<h4 id="i-medication">
<strong>i) Medication</strong><a class="anchor" aria-label="anchor" href="#i-medication"></a>
</h4>
<p>The extraction of medication type and dose is important for lots of analyses in endoscopy. This is provided with the function <strong>EndoscMeds</strong>. The function currently extracts Fentanyl, Pethidine, Midazolam and Propofol doses into a separate column and reformats them as numeric columns so further calculations can be done. It outputs a dataframe so you will need to re-bind this output with the original dataframe for further analyses. This is shown below:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MyendoMeds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="../reference/EndoscMeds.html">EndoscMeds</a></span><span class="op">(</span><span class="va">Myendo</span><span class="op">$</span><span class="va">Medications</span><span class="op">)</span>, <span class="va">Myendo</span><span class="op">)</span></span></code></pre></div>
<table style="width:75%;" class="table">
<colgroup>
<col width="43%">
<col width="9%">
<col width="11%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="center">MedColumn</th>
<th align="center">Fent</th>
<th align="center">Midaz</th>
<th align="center">Peth</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Fentanyl 12 5mcg Midazolam 6mg</td>
<td align="center">NA</td>
<td align="center">6</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">Fentanyl 125mcg Midazolam 7mg</td>
<td align="center">125</td>
<td align="center">7</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">Fentanyl 125mcg Midazolam 6mg</td>
<td align="center">125</td>
<td align="center">6</td>
<td align="center">NA</td>
</tr>
<tr class="even">
<td align="center">Fentanyl 12 5mcg Midazolam 2mg</td>
<td align="center">NA</td>
<td align="center">2</td>
<td align="center">NA</td>
</tr>
<tr class="odd">
<td align="center">Fentanyl 75mcg Midazolam 6mg</td>
<td align="center">75</td>
<td align="center">6</td>
<td align="center">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="ii-endosccopy-event-extraction">
<strong>ii) Endosccopy Event extraction</strong><a class="anchor" aria-label="anchor" href="#ii-endosccopy-event-extraction"></a>
</h4>
<p>The <strong>EndoscopyEvent</strong> function will extract any event that has been performed at the endoscopy and dump it in a new column. It does this by looking in pairs of sentences and therefore wraps around a more basic function called <strong>EndoscopyPairs_TwoSentence</strong> which you dont have to directly use. This allows us to get the site that the event (usually a therapy) happened on. A example sentence might be ‘There was a bleeding gastric ulcer. A clip was applied to it’ We can only extract stomach:clip by reference to the two sentences.</p>
</div>
<div class="section level4">
<h4 id="iii-histology-biopsy-number-extraction">
<strong>iii) Histology biopsy number extraction</strong><a class="anchor" aria-label="anchor" href="#iii-histology-biopsy-number-extraction"></a>
</h4>
<p>There is also a lot of information we can extract into a separate column from the histopathology information. We can derive the number of biopsies taken (usually specified in the macroscopic description of a sample) using the function <strong>HistolNumbOfBx</strong>.</p>
<p>In order to extract the numbers, the limit of what has to be extracted has to be set as part of the regex so that the function takes whatever word limits the selection.It collects everything from the regex [0-9]{1,2}.{0,3} to whatever the string boundary is.</p>
<p>For example, a report might say:</p>
<p><br></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sg</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Mypath</span><span class="op">$</span><span class="va">HospitalNumber</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">PatientName</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">Macroscopicdescription</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="30%">
<col width="28%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th align="center">Mypath.HospitalNumber</th>
<th align="center">Mypath.PatientName</th>
<th align="center">Mypath.Macroscopicdescription</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">3 specimens collected the largest measuring 3 x 2 x 1 mm and the smallest 2 x 1 x 5 mm</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">4 specimens collected the largest measuring 4 x 4 x 4 mm and the smallest 5 x 3 x 1 mm</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">9 specimens collected the largest measuring 2 x 5 x 2 mm and the smallest 1 x 1 x 4 mm</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">4 specimens collected the largest measuring 5 x 4 x 1 mm and the smallest 1 x 3 x 3 mm</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">5 specimens collected the largest measuring 2 x 2 x 1 mm and the smallest 3 x 4 x 3 mm</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>Based on this, the word that limits the number you are interested in is ‘specimen’ so the function and it’s output is:</p>
<p><br></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mypath</span><span class="op">$</span><span class="va">NumbOfBx</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/HistolNumbOfBx.html">HistolNumbOfBx</a></span><span class="op">(</span><span class="va">Mypath</span><span class="op">$</span><span class="va">Macroscopicdescription</span>,<span class="st">'specimen'</span><span class="op">)</span></span>
<span><span class="va">sh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Mypath</span><span class="op">$</span><span class="va">HospitalNumber</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">PatientName</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">NumbOfBx</span><span class="op">)</span></span></code></pre></div>
<table style="width:90%;" class="table">
<colgroup>
<col width="33%">
<col width="31%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center">Mypath.HospitalNumber</th>
<th align="center">Mypath.PatientName</th>
<th align="center">Mypath.NumbOfBx</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">3</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">9</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">5</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="iv-histology-biopsy-size-extraction">
<strong>iv) Histology biopsy size extraction</strong><a class="anchor" aria-label="anchor" href="#iv-histology-biopsy-size-extraction"></a>
</h4>
<p>We might also be interested in the size of the biopsy taken. A further function called <strong>HistolBxSize</strong> is provided for this. This is also derived from the macroscopic description of the specimen</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Mypath</span><span class="op">$</span><span class="va">BxSize</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/HistolBxSize.html">HistolBxSize</a></span><span class="op">(</span><span class="va">Mypath</span><span class="op">$</span><span class="va">Macroscopicdescription</span><span class="op">)</span></span>
<span><span class="va">sh</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">Mypath</span><span class="op">$</span><span class="va">HospitalNumber</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">PatientName</span>,<span class="va">Mypath</span><span class="op">$</span><span class="va">BxSize</span><span class="op">)</span></span></code></pre></div>
<table style="width:87%;" class="table">
<colgroup>
<col width="33%">
<col width="31%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">Mypath.HospitalNumber</th>
<th align="center">Mypath.PatientName</th>
<th align="center">Mypath.BxSize</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">J6044658</td>
<td align="center">Jargon, Victoria</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">Y6417773</td>
<td align="center">Powell, Destiny</td>
<td align="center">64</td>
</tr>
<tr class="odd">
<td align="center">B6072011</td>
<td align="center">Martinez-Santos, Ana</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="center">G1449886</td>
<td align="center">Lopez, Maria</td>
<td align="center">20</td>
</tr>
<tr class="odd">
<td align="center">V1607560</td>
<td align="center">al-Rahimi, Rif’a</td>
<td align="center">4</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="v-histology-type-and-site-extraction">
<strong>v) Histology type and site extraction</strong><a class="anchor" aria-label="anchor" href="#v-histology-type-and-site-extraction"></a>
</h4>
<p>A final function is also provided called <strong>HistolTypeAndSite</strong>. This is particularly useful when trying to find out which biopsies came from which site. The output is provided as a site:specimen type pair. An alternative output is also provided which groups locations (eg the gastro-oesophageal junction is seen as part of the oesophagus).</p>
<p>##<strong>And this is just the beginning…</strong></p>
<p>What is described above are the building blocks for starting a more complex analysis of the Endoscopic and Pathological data.</p>
<p>Generic analyses, such as figuring out surveillance intervals, can be determined using the appropriate functions in the Analysis module.</p>
<p>The dataset can also be fed in to more complex functions as are described in the Barrett’s and Polyp modules</p>
<p>The package also provides generic data visualisation tools to assess Patient flow, amonst other visualisations. All of these can be found in the associated vignettes.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
